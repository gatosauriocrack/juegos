<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Clasificaci√≥n Global: Buscaminas</title>
    <style>
        :root {
            --color-principal: #EA7900;
            --color-secundario: #ffb86c;
            --color-fondo: #282c34;
            --color-tarjeta: #3b4252;
            --color-texto: #e0e0e0;
            --color-record: #4CAF50;
            --color-bomba: #D32F2F;
            --color-sombra-naranja: #a45400;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            /* Ajustado para que coincida con el contenedor de la tabla */
            max-width: 1000px; 
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--color-principal);
            font-size: 3em; /* Ligeramente m√°s grande para PC */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
        }
        
        #highscores-container {
            width: 100%;
            /* ‚≠ê MODIFICACI√ìN CLAVE PARA PC: Aumentar el ancho m√°ximo */
            max-width: 1000px; 
            background-color: var(--color-tarjeta);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); 
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 2px;
            text-align: left;
        }

        #highscores-container thead {
            border-radius: 10px 10px 0 0;
        }

        th, td {
            padding: 15px 20px; /* Un poco m√°s de padding para mejor legibilidad en PC */
            border-bottom: none; 
        }

        th {
            background-color: var(--color-principal);
            color: var(--color-fondo);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 1.1em; /* Header m√°s visible */
        }

        tr {
             background-color: var(--color-tarjeta);
             transition: background-color 0.2s;
        }

        tr:nth-child(even) {
            background-color: #4b5263;
        }

        tr:hover {
            background-color: #5d667d;
        }

        .position {
            font-weight: bold;
            text-align: center;
            width: 60px; /* Un poco m√°s de espacio para la posici√≥n */
        }
        
        .position.rank-1 { background-color: gold; color: #333; }
        .position.rank-2 { background-color: silver; color: #333; }
        .position.rank-3 { background-color: #cd7f32; color: #333; }
        
        .score-value {
            font-weight: bold;
            color: var(--color-record);
        }
        
        .empty-message {
            padding: 30px; /* Un poco m√°s de padding */
            text-align: center;
            color: var(--color-secundario);
            font-style: italic;
            font-size: 1.1em;
        }
        
        #loading-message {
            display: none;
            padding: 40px;
            font-size: 1.4em;
            color: var(--color-principal);
        }
        
        #info-message {
            margin-top: 5px;
            font-size: 1.1em; /* Texto de informaci√≥n m√°s legible */
            color: var(--color-secundario);
            text-align: center;
        }
        
        .return-link a {
            color: var(--color-principal);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
            font-size: 1.1em; /* Enlace m√°s grande */
        }
        .return-link a:hover {
            color: var(--color-secundario);
        }
        
        /* Media query adaptada para mantener la responsividad en m√≥viles/tabletas */
        @media (max-width: 1050px) { /* El ajuste de 1050px permite el ancho m√°ximo de 1000px m√°s el padding */
             header {
                max-width: 95%; /* Ajuste para evitar desbordamiento */
            }
            #highscores-container {
                max-width: 95%; 
            }
        }
        
        @media (max-width: 650px) {
            /* Reglas originales para pantallas m√°s peque√±as */
            #highscores-container {
                max-width: 100%;
            }
            #highscores-container table {
                font-size: 0.9em;
            }
            th, td {
                padding: 10px 8px;
            }
            h1 {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üèÜ Clasificaci√≥n Global: <span id="game-title">Buscaminas</span></h1>
        <p id="info-message"></p>
    </header>

    <div id="highscores-container">
        <table>
            <thead>
                <tr>
                    <th class="position">#</th>
                    <th>Usuario</th>
                    <th>Tiempo (s)</th>
                    <th>Dificultad</th>
                </tr>
            </thead>
            <tbody id="highscores-body">
                </tbody>
        </table>
        <div id="loading-message">Cargando r√©cords...</div>
        <div id="no-records-message" class="empty-message" style="display: none;">A√∫n no hay r√©cords</div>
    </div>
    
    <p id="returnButtonContainer" class="return-link" style="margin-top: 20px; display: none;">
        <a href="https://gatosauriocrack.github.io/juegos/Buscaminas">‚Üê Volver al juego</a> 
    </p>

    <script>
        const RENDER_API_URL = "https://procesador-de-records.onrender.com"; 
        const GAME_API_KEY = 'Buscaminas_game'; 
        const TARGET_SPEED = '30x29 (99 Minas)'; 
        
        const highscoresBody = document.getElementById('highscores-body');
        const loadingMessage = document.getElementById('loading-message');
        const noRecordsMessage = document.getElementById('no-records-message');
        const gameTitle = document.getElementById('game-title');

        function init() {
            fetchHighscores();
            // üëá MODIFICACI√ìN 3: Llamar a la comprobaci√≥n de origen al inicio
            checkURLOrigin();
        }

        async function fetchHighscores() {
            highscoresBody.innerHTML = '';
            loadingMessage.style.display = 'block';
            noRecordsMessage.style.display = 'none';

            const url = `${RENDER_API_URL}/get_records?game_name=${GAME_API_KEY}&speed=${encodeURIComponent(TARGET_SPEED)}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                loadingMessage.style.display = 'none';

                if (response.ok && data.highscores.length > 0) {
                    displayHighscores(data.highscores);
                } else {
                    noRecordsMessage.style.display = 'block';
                }

            } catch (error) {
                loadingMessage.style.display = 'none';
                highscoresBody.innerHTML = `<tr><td colspan="4" class="empty-message" style="color: var(--color-bomba)">Error al cargar la clasificaci√≥n. El servidor podr√≠a estar inactivo.</td></tr>`;
                console.error("Error fetching highscores:", error);
            }
        }

        function displayHighscores(highscores) {
            highscoresBody.innerHTML = '';
            
            highscores.forEach((record, index) => {
                const row = highscoresBody.insertRow();
                
                const rankCell = row.insertCell();
                rankCell.textContent = index + 1;
                rankCell.classList.add('position');
                if (index === 0) rankCell.classList.add('rank-1');
                else if (index === 1) rankCell.classList.add('rank-2');
                else if (index === 2) rankCell.classList.add('rank-3');

                row.insertCell().textContent = record.username;

                const scoreCell = row.insertCell();
                scoreCell.textContent = `${record.score}s`;
                scoreCell.classList.add('score-value');
                
                row.insertCell().textContent = record.speed;
            });
        }
        
        // üëá MODIFICACI√ìN 2: Funci√≥n para comprobar el origen
        function checkURLOrigin() {
            const urlParams = new URLSearchParams(window.location.search);
            const returnButton = document.getElementById('returnButtonContainer');
            
            // Si la URL contiene ?from=game, muestra el bot√≥n.
            if (urlParams.get('from') === 'game') {
                if (returnButton) {
                    returnButton.style.display = 'block';
                }
            } 
        }

        window.onload = init;
    </script>
</body>
</html>
